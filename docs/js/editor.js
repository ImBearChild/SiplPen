SiplPen.editor=function(){var e,t,n,o,a,c,i,l,r,s,u,d,m,p=C;function f(e){e.stopPropagation(),e.preventDefault();var t="",n=e.originalEvent||e;n.clipboardData&&n.clipboardData.getData?t=n.clipboardData.getData("text/plain"):window.clipboardData&&window.clipboardData.getData&&(t=window.clipboardData.getData("Text"));var o=t.split("\n");if(1===o.length);else for(j=0,len=o.length;j<len;j++)""!==o[j]&&(o[j]="<p>"+o[j]+"</p>");!1===document.execCommand("insertHTML",!1,o.join(""))&&alert(alertContent2)}function g(e){var t=window.getSelection();if("url-input"===e.target.className||e.target.classList.contains("url")||e.target.parentNode.classList.contains("ui-inputs"))return o=N(t.focusNode),void S();!0===t.isCollapsed&&!1===n&&(c.className="text-options fade",setTimeout((function(){"text-options fade"==c.className&&(c.className="text-options",c.style.top="-999px",c.style.left="-999px")}),260)),!1===t.isCollapsed&&!1===m&&v(o=N(t.focusNode),"ARTICLE")&&(S(),w(),c.className="text-options active"),n=t.isCollapsed}function w(){var e=window.getSelection();try{var t=e.getRangeAt(0).getBoundingClientRect();"ontouchstart"in window||(c.style.top=t.top-5+window.pageYOffset+"px",c.style.left=(t.left+t.right)/2+"px")}catch(e){console.error(e)}}function S(){v(o,"B")?l.className="bold active":l.className="bold",v(o,"I")?r.className="italic active":r.className="italic",v(o,"BLOCKQUOTE")?s.className="quote active":s.className="quote",v(o,"A")?u.className="url active":u.className="url"}function N(e){var t={};for(window.getSelection();e.parentNode;)t[e.nodeName]=!0,"A"===(e=e.parentNode).nodeName&&(t.url=e.href);return t}function v(e,t){return!!e[t]}function C(n){localStorage.header=e.innerHTML,localStorage.content=t.innerHTML}function h(){t.innerHTML=SiplPen.translater.getTran("defaultContent")}function x(){document.execCommand("bold",!1)}function y(){document.execCommand("italic",!1)}function L(){v(N(window.getSelection().focusNode),"BLOCKQUOTE")?(document.execCommand("formatBlock",!1,"p"),document.execCommand("outdent")):document.execCommand("formatBlock",!1,"blockquote")}function T(){"options"==i.className?(i.className="options url-mode",setTimeout((function(){var e=N(window.getSelection().focusNode);v(e,"A")?d.value=e.url:document.execCommand("createLink",!1,"/"),a=window.getSelection().getRangeAt(0),n=!1,d.focus()}),100)):"options options-mobile"==i.className?(a=window.getSelection().getRangeAt(0),nodeNames=N(window.getSelection().focusNode),word=prompt("URL:",nodeNames.url),window.getSelection(),q(word)):"ontouchstart"in window?i.className="options options-mobile":i.className="options "}function b(e){13===e.keyCode&&(e.preventDefault(),q(d.value),d.blur())}function k(e){i.className="options",q(d.value),d.value="",o=N(window.getSelection().focusNode),S()}function q(e){!function(){var e=window.getSelection();e.rangeCount>0&&e.removeAllRanges();e.addRange(a)}(),document.execCommand("unlink",!1),""!==e&&(e.match("[A-z]*://")||(e="http://"+e),document.execCommand("createLink",!1,e))}function D(e){m=!0}function E(e){m=!1}return{init:function(){m=!1,e=document.querySelector(".header"),t=document.querySelector(".content"),c=document.querySelector(".text-options"),i=c.querySelector(".options"),(l=c.querySelector(".bold")).onclick=x,(r=c.querySelector(".italic")).onclick=y,(s=c.querySelector(".quote")).onclick=L,(u=c.querySelector(".url")).onmousedown=T,(d=c.querySelector(".url-input")).onblur=k,d.onkeydown=b,function(){SiplPen.util.supportsHtmlStorage()?document.onkeyup=function(e){p(),g(e)}:document.onkeyup=g;document.onmousedown=g,document.onmouseup=function(e){setTimeout((function(){g(e)}),1)},document.oncontextmenu=function(e){setTimeout((function(){g(e)}),1)},window.addEventListener("resize",(function(e){w()})),document.body.addEventListener("scroll",(function(){w()})),document.addEventListener("compositionstart",D),document.addEventListener("compositionend",E)}(),SiplPen.util.supportsHtmlStorage()?function(){localStorage.header?e.innerHTML=localStorage.header:e.innerHTML=SiplPen.translater.getTran("defaultTitle");localStorage.content?t.innerHTML=localStorage.content:h()}():(e.innerHTML=defaultTitle,h());var n=document.createRange(),o=window.getSelection();n.setStart(e,1),o.removeAllRanges(),o.addRange(n),"ontouchstart"in window&&i.classList.add("options-mobile"),document.execCommand("defaultParagraphSeparator",!1,"p"),t.addEventListener("paste",f)},saveState:C,getWordCount:function(){var e,n=SiplPen.util.getText(t);if(""===n)return 0;try{str=n.replace(/(\r\n+|\s+|　+)/g,"￿"),str=str.replace(/[\x00-\xff]/g,"m"),str=str.replace(/m+/g,"*"),str=str.replace(/\uffff+/g,""),e=str.length}catch(e){}return e},cls:function(){paras=document.getElementsByClassName("content")[0],childs=paras.childNodes;for(var e=childs.length-1;e>=0;e--)paras.removeChild(childs[e]);document.getElementsByClassName("content")[0].style.opacity=1,C()},loadDefaultContent:h,startStrictFlow:function(){localStorage.header=e.innerHTML,localStorage.content="",p=function(){}},finishStrictFlow:function(){C(),p=C}}}();