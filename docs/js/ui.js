"use strict";SiplPen.ui=function(){var e,t,o,l,n,c,r,a,i,s,u,f,d,m,g,y,S,p,v,w,q,h,I,k,b,_,P,L,C=0,T=!1,x=!1;function N(e){screenfull.toggle(),screenfull.enabled&&document.addEventListener(screenfull.raw.fullscreenchange,(function(){screenfull.isFullscreen?l.innerHTML='<i class="fa fa-compress fa-fw" aria-hidden="true"></i>':l.innerHTML='<i class="fa fa-arrows-alt fa-fw" aria-hidden="true"></i>'}))}function E(e){"true"===localStorage.darkLayout?(document.body.classList.remove("yin"),document.body.classList.add("yang"),localStorage.darkLayout=!1):(document.body.classList.remove("yang"),document.body.classList.add("yin"),localStorage.darkLayout=!0)}function B(e){SiplPen.util.fadeIn(t),SiplPen.util.fadeIn(r),a.focus()}function F(e){!1===T?(SiplPen.util.fadeIn(t),SiplPen.util.fadeIn(m)):(SiplPen.util.fadeIn(t),SiplPen.util.fadeIn(S))}function H(e){document.getElementById("wordcountinfo").innerText=SiplPen.editor.getWordCount(),SiplPen.util.fadeIn(t),SiplPen.util.fadeIn(P)}function M(e){te(),SiplPen.util.fadeIn(t),SiplPen.util.fadeIn(_)}function A(e){!1===T?(SiplPen.util.fadeIn(t),SiplPen.util.fadeIn(g)):(SiplPen.util.fadeIn(t),SiplPen.util.fadeIn(S))}function W(e){if(void 0!==f&&""!=f){var t=new Blob([d],{type:"text/plain;charset=utf-8"}),l=o.innerHTML.replace(/(\t|\n|\r)/gm,"");""===l&&(l="SiplPen"),saveAs(t,l+".txt")}else document.querySelector(".saveoverlay h1").style.color="#FC1E1E"}function D(t){13===t.keyCode&&(t.preventDefault(),e.focus())}function O(t){13===t.keyCode&&(t.preventDefault(),G(parseInt(this.value)),U(),e.focus())}function $(e){G(parseInt(this.value))}function j(){C+=1,s.className="counter-bar active"}function z(){(C-=1)<=0&&(s.className="counter-bar")}function G(e){e>0?(c=e,j(),K()):(c=0,i.style.width=0,z()),SiplPen.util.supportsHtmlStorage()&&(localStorage.wordCount=a.value)}function J(e){c>0&&K()}function K(){var e=SiplPen.editor.getWordCount()/c;i.style.width=100*e+"%",i.className=e>=1?"word-progress progress complete":"word-progress progress"}function Q(e){var t;if(document.querySelectorAll("span.activesave").length>0&&(document.querySelector("span.activesave").className=""),document.querySelector(".saveoverlay h1").style.cssText="",!e)e=window.event;e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),t.className="activesave",f=t.getAttribute("data-format");var o=document.querySelector("header.header").innerHTML.replace(/(\r\n|\n|\r)/gm,"")+"\n",l=document.querySelector("article.content").innerHTML;d=function(e,t,o){var l;switch(e){case"html":l=(l=(t="<h1>"+t+"</h1>")+o).replace(/\t/g,"");break;case"markdown":t="#"+(t=(t=t.replace(/\t/g,"")).replace(/\n$/,""))+"#";var n=(l=(l=o.replace(/\t/g,"")).replace(/<b>|<\/b>/g,"**").replace(/\r\n+|\r+|\n+|\t+/gi,"").replace(/<i>|<\/i>/g,"_").replace(/<blockquote>/g,"> ").replace(/<\/blockquote>/g,"").replace(/<p>|<\/p>/gi,"\n").replace(/<br>/g,"\n")).match(/<a href="(.+)">(.+)<\/a>/gi);if(null!==n)for(var c=0;c<n.length;c++){var r=document.createElement("div");r.innerHTML=n[c];var a=(s=r.firstChild).getAttribute("href"),i=s.textContent||s.innerText||"";l=l.replace(n[c],"["+i+"]("+a+")")}l=t+"\n\n"+l;break;case"plain":var s;t=t.replace(/\t/g,""),(s=document.createElement("div")).innerHTML=o,l=(l=s.textContent||s.innerText||"").replace(/\t/g,"").replace(/\n{3}/g,"\n").replace(/\n/,""),l=t+l}return l}(f,o,l);var n=document.querySelector(".hiddentextbox");n.value=d,n.focus(),n.select()}function R(e){"overlay"===e.target.className&&U()}function U(){SiplPen.util.fadeOut(t),setTimeout((function(){for(var e=t.getElementsByClassName("modal"),o=e.length-1;o>=0;o--)e[o].style.display="none";document.querySelector(".finishsummary ").style.display="none"}),500),document.querySelectorAll("span.activesave").length>0&&(document.querySelector("span.activesave").className=""),f=""}function V(){w>0?w-=1:(console.info("Flowstate mode completed"),ee())}function X(){q>0?(q-=1,document.getElementsByClassName("content")[0].style.opacity=document.getElementsByClassName("content")[0].style.opacity-k):(console.info("Flowstate ended in failure"),SiplPen.editor.cls(),Z(),SiplPen.util.fadeIn(t),SiplPen.util.fadeIn(y))}function Y(){document.getElementsByClassName("content")[0].style.opacity=1}function Z(){clearInterval(h),clearInterval(I),Y(),z(),window.oncontextmenu=null,document.body.oncopy=null,SiplPen.editor.finishStrictFlow(),b.style.transition="",b.style.width="0px",T=!1}function ee(){Z(),SiplPen.util.fadeIn(t),SiplPen.util.fadeIn(m),(n=document.querySelector(".finishsummary ")).innerHTML=n.innerHTML.replace("{s}",p/60),n.style.display="block"}function te(){-1!=window.location.search.indexOf("lang=")&&(document.getElementById("langarginform").style.display="block"),"true"===localStorage.getItem("src_font")?document.querySelector("#toggleFont i").className="fa fa-fw fa-check-square-o":"false"===localStorage.getItem("src_font")?document.querySelector("#toggleFont i").className="fa fa-fw fa-square-o":localStorage.src_font=!1,"true"===localStorage.getItem("strict_flow")?document.querySelector("#toggleStrict i").className="fa fa-fw fa-check-square-o":"false"===localStorage.getItem("strict_flow")?document.querySelector("#toggleStrict i").className="fa fa-fw fa-square-o":localStorage.strict_flow=!1,"true"===localStorage.getItem("spell_check")?document.querySelector("#toggleSpellCheck i").className="fa fa-fw fa-check-square-o":"false"===localStorage.getItem("strict_flow")?document.querySelector("#toggleSpellCheck i").className="fa fa-fw fa-square-o":localStorage.spell_check=!1}return{init:function(){u=!!new Blob,function(){if(document.body,document.querySelector(".ui"),document.querySelector(".color-flip").onclick=E,(l=document.querySelector(".fullscreen")).onclick=N,(n=document.querySelector(".target ")).onclick=B,(n=document.querySelector(".infobtn ")).onclick=H,(n=document.querySelector(".settingbtn ")).onclick=M,(n=document.querySelector(".flowstate ")).onclick=A,(n=document.querySelector(".startflow")).onclick=function(){p=60*document.getElementsByName("total_time")[0].value,v=10*document.getElementsByName("expiring_time")[0].value,w=p,k=1/(q=v),function(){!0===x&&(console.info("Strict Mode is enabled"),SiplPen.editor.startStrictFlow(),window.oncontextmenu=function(e){e.preventDefault()},document.body.oncopy=function(){return!1});console.info("Starting flowstate mode: "+w+" , "+q+" , "+k),Y(),(n=document.querySelector(".content")).oninput=function(){q=v,Y()},h=setInterval(V,1e3),I=setInterval(X,100),T=!0,j(),b.style.transition="width "+p+"s",b.style.transitionTimingFunction="linear",b.style.width="100%"}(),U()},u){document.querySelector(".save").onclick=F;for(var c=document.querySelectorAll(".saveselection span"),f=0,d=c.length;f<d;f++)c[f].onclick=Q;document.querySelector(".savebutton").onclick=W}else document.querySelector(".save.useicons").style.display="none";(t=document.querySelector(".overlay")).onclick=R,(e=document.querySelector(".content")).onkeyup=J,r=t.querySelector(".wordcount"),(a=r.querySelector("input")).onchange=$,a.onkeyup=O,m=t.querySelector(".saveoverlay"),s=document.querySelector(".counter-bar"),i=s.querySelector(".word-progress"),g=t.querySelector(".flowsettings"),y=t.querySelector(".flowfailure"),b=s.querySelector(".time-progress"),S=t.querySelector(".flowing"),_=t.querySelector(".settings"),P=t.querySelector(".info"),L=s.querySelector(".font-progress"),(o=document.querySelector(".header")).onkeypress=D}(),function(){"true"===localStorage.getItem("src_font")?document.querySelector("body").classList.add("src-font"):"false"===localStorage.getItem("src_font")&&document.querySelector("body").classList.remove("src-font");"true"===localStorage.getItem("strict_flow")?x=!0:"false"===localStorage.getItem("strict_flow")&&(x=!1);document.querySelector("article").spellcheck=localStorage.spell_check,"true"===localStorage.getItem("spell_check")?document.querySelector("article").spellcheck=!0:("false"===localStorage.getItem("strict_flow")||(localStorage.spell_check=!1),document.querySelector("article").spellcheck=!1)}(),SiplPen.translater.init(),SiplPen.util.supportsHtmlStorage()&&function(){localStorage.wordCount&&"0"!==localStorage.wordCount&&(c=parseInt(localStorage.wordCount),a.value=localStorage.wordCount,G(parseInt(localStorage.wordCount)),K());"true"===localStorage.darkLayout&&(document.body.className="yin")}(),console.log(SiplPen.translater.getTran("consoleText1"))},flowCompleted:ee,unclaimCount:z,s_cleanLocalStorage:function(){if(!0===confirm(SiplPen.translater.getTran("confirmContent1"))){var e=localStorage["t-lang"];localStorage.clear(),localStorage["t-lang"]=e,window.location.reload()}},s_toggleFont:function(){if("false"===localStorage.src_font){document.querySelector("body").classList.add("src-font"),localStorage.src_font=!0;var e=setTimeout((function(){document.getElementById("spanfontloading").style.display="inline"}),100);j();var t=0;0===t?(L.style.marginLeft=window.innerWidth+"px",t=1):(L.style.marginLeft="-33px",t=0);var o=setInterval((function(){0===t?(L.style.marginLeft=window.innerWidth+"px",t=1):(L.style.marginLeft="-33px",t=0)}),5e3);new FontFaceObserver("SourceHanSerifWeb").load(null,1e5).then((function(){clearInterval(o),clearTimeout(e),z(),setTimeout((function(){document.getElementById("spanfontloading").style.display="none"}),1e3),L.style.marginLeft="-33px",console.log("Font is available")}),(function(){z(),setTimeout((function(){document.getElementById("spanfontloading").style.display="none",document.getElementById("spanfontfailed").style.display="inline"}),1e3),console.log("Font is not available"),clearInterval(o),L.style.marginLeft="-33px",clearTimeout(e)}))}else"true"===localStorage.src_font?(document.querySelector("body").classList.remove("src-font"),localStorage.src_font=!1):alert(alertContent1);te()},s_toggleStrict:function(){"true"===localStorage.getItem("strict_flow")?(localStorage.strict_flow=!1,x=!1):"false"===localStorage.getItem("strict_flow")?(localStorage.strict_flow=!0,x=!0):alert(alertContent1),te()},s_toggleSpellCheck:function(){"true"===localStorage.spell_check?(localStorage.spell_check=!1,document.querySelector("article").spellcheck=!1):"false"===localStorage.spell_check?(localStorage.spell_check=!0,document.querySelector("article").spellcheck=!0):alert(alertContent1),te()}}}();